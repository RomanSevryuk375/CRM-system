<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:CRMSystemMobile.ViewModels"
             xmlns:contracts="clr-namespace:Shared.Contracts.Car;assembly=Shared" xmlns:d="http://schemas.microsoft.com/dotnet/2021/maui/design"
             x:Class="CRMSystemMobile.View.MyCarsPage"
             x:DataType="vm:MyCarsViewModel"
             Shell.NavBarIsVisible="False"
             Title="Мои автомобили">

    <Grid RowDefinitions="Auto, *" BackgroundColor="#112347">

        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto, *" Padding="15, 20" HeightRequest="80">
            <ImageButton Grid.Column="0"
                         Source="back_arrow.png" 
                         HeightRequest="24"
                         HorizontalOptions="Start"
                         Command="{Binding GoBackCommand}">
                <d:ImageButton.Source>
                    <FontImageSource Glyph="&#x2190;" Color="White" Size="24" />
                </d:ImageButton.Source>
            </ImageButton>

            <Label Grid.Column="1" 
                   Text="Мои автомобили" 
                   TextColor="White" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   Margin="-24,0,0,0"/>
        </Grid>

        <!-- List -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding LoadCarsCommand}" 
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="#112347">

            <CollectionView ItemsSource="{Binding Cars}" Margin="0,10,0,0">
                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="Нет добавленных автомобилей" TextColor="Gray" />
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="contracts:CarResponse">
                        <Border BackgroundColor="#213868"
                                Stroke="Transparent"
                                Padding="15" 
                                StrokeShape="RoundRectangle 12"
                                Margin="15, 8">
                            <Grid ColumnDefinitions="Auto, *" ColumnSpacing="15">
                                <!-- Иконка авто (заглушка или из ресурсов) -->
                                <Border Grid.Column="0"
                                        HeightRequest="50"
                                        WidthRequest="50"
                                        StrokeShape="RoundRectangle 25"
                                        BackgroundColor="#304B80"
                                        StrokeThickness="0">
                                    <Label Text="AUTO" 
                                           TextColor="White" 
                                           FontSize="12" 
                                           HorizontalOptions="Center" 
                                           VerticalOptions="Center"
                                           FontAttributes="Bold"/>
                                </Border>

                                <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                    <Label TextColor="White" 
                                           FontSize="16" 
                                           FontAttributes="Bold">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding Brand}"/>
                                                <Span Text=" "/>
                                                <Span Text="{Binding Model}"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>

                                    <Label Text="{Binding StateNumber}" 
                                           TextColor="#FFB347" 
                                           FontSize="14" 
                                           FontAttributes="Bold"/>

                                    <Label TextColor="#ACACAC" FontSize="12">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="VIN: "/>
                                                <Span Text="{Binding VinNumber}"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                           IsRunning="{Binding IsBusy}" 
                           IsVisible="{Binding IsBusy}"
                           Color="White"
                           VerticalOptions="Center" 
                           HorizontalOptions="Center"/>
    </Grid>
</ContentPage>